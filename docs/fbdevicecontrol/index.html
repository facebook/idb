<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-fbdevicecontrol" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">FBDeviceControl | idb</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fbidb.io/docs/fbdevicecontrol"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FBDeviceControl | idb"><meta data-rh="true" name="description" content="FBDeviceControl is the macOS Framework that implements all functionality associated with iOS Devices within idb. It can be used independently of idb as it is a standalone Framework."><meta data-rh="true" property="og:description" content="FBDeviceControl is the macOS Framework that implements all functionality associated with iOS Devices within idb. It can be used independently of idb as it is a standalone Framework."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://fbidb.io/docs/fbdevicecontrol"><link data-rh="true" rel="alternate" href="https://fbidb.io/docs/fbdevicecontrol" hreflang="en"><link data-rh="true" rel="alternate" href="https://fbidb.io/docs/fbdevicecontrol" hreflang="x-default"><script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.37326b2d.css">
<script src="/assets/js/runtime~main.6e9a5379.js" defer="defer"></script>
<script src="/assets/js/main.b20b3130.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/oss_logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">idb</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/overview">Getting Started</a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guided-tour">Guided Tour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/development">Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/commands">Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/fbsimulatorcontrol">FBSimulatorControl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/fbdevicecontrol">FBDeviceControl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video">Video</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/test-execution">Test Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/file-containers">File Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/accessibility">Accessibility Automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faqs">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FBDeviceControl</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FBDeviceControl</h1></header><p><code>FBDeviceControl</code> is the macOS Framework that implements all functionality associated with iOS Devices within <code>idb</code>. It can be used independently of <code>idb</code> as it is a standalone Framework.</p>
<p>This page contains information about the implementation details of how iOS Device access works from macOS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mobiledeviceframework"><code>MobileDevice.framework</code><a href="#mobiledeviceframework" class="hash-link" aria-label="Direct link to mobiledeviceframework" title="Direct link to mobiledeviceframework">â€‹</a></h2>
<p><code>MobileDevice.framework</code> is a System Framework for macOS. It&#x27;s default location is at <code>/System/Library/PrivateFrameworks/MobileDevice.framework/MobileDevice</code>. This is a Private Framework, there is no Apple-provided documentation for it. Most of it&#x27;s API is of the CoreFoundation style, which means that most of it&#x27;s surface is made up of plain C symbols with <code>CF</code> objects passed in or out. As such, this makes integration into an Objective-C Framework (like <code>FBDeviceControl</code>) relitavely simple, since <code>CF</code> objects are often <a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/tollFreeBridgedTypes.html" target="_blank" rel="noopener noreferrer">Toll-Free Bridged to Objective-C</a>.</p>
<p>At a first glance, this Framework is difficult to deal with since Private APIs are typically easier to work with if they export Objective-C classes. However, most of the usual patterns around how <code>CoreFoundation</code> APIs do apply. <code>MobileDevice.framework</code> is used extensively across Apple&#x27;s macOS Applications that interact with iOS Devices (Finder/iTunes, Xcode, Accessibility Inspector, Apple Configurator 2, Photos). If an Application uses an iOS Device on macOS, it is extremely likely to leverage <code>MobileDevice.framework</code>.</p>
<p>This wealth of &quot;clients&quot; of <code>MobileDevice.framework</code> has made it possible to understand how each of the API calls work in terms of their inputs and outputs. As a result, <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Management/FBAMDefines.h" target="_blank" rel="noopener noreferrer">there&#x27;s a header that defines all of the calls that <code>FBDeviceControl</code> uses</a>.</p>
<p><code>FBDeviceControl</code> aims to use these APIs as far as possible, <code>MobileDevice.framework</code> is assumed to be the &quot;canonical&quot; way to interact with iOS Devices on macOS. The <code>libimobiledevice</code> project is essentially a <a href="https://libimobiledevice.org" target="_blank" rel="noopener noreferrer">re-implementation of <code>MobileDevice.framework</code> that runs on different host operating systems</a>. There&#x27;s also a range of other projects that use <code>MobileDevice.framework</code> including <a href="https://github.com/samdmarshall/SDMMobileDevice/blob/main/SDM_MD_Tests/MobileDevice.h" target="_blank" rel="noopener noreferrer"><code>SDMMobileDevice</code></a>, <a href="https://github.com/mountainstorm/MobileDevice" target="_blank" rel="noopener noreferrer"><code>MobileDevice</code></a> and <a href="https://github.com/iOSForensics/pymobiledevice" target="_blank" rel="noopener noreferrer"><code>pymobiledevice</code></a> and more.</p>
<p>There are some exceptions to the level of support for iOS Device operations within <code>MobileDevice.framework</code>; some functionality is provided via Xcode itself. This means that some device operations will be fully functional without Xcode installed (and <code>xcode-select</code>&#x27;ed), but some functionality is dependent on the presence of an Xcode on the host. Typically the functionality that requires Xcode, is only available through Xcode to begin with. <code>FBDeviceControl</code> will attempt to defer the loading of Xcode specific functionality until it is used in order to prevent failure for when Xcode is not required. For example if iOS Device listing is only used on a host without Xcode, the device listing functionality will still work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amdevice"><code>AMDevice</code><a href="#amdevice" class="hash-link" aria-label="Direct link to amdevice" title="Direct link to amdevice">â€‹</a></h2>
<p><code>AMDevice</code> is a CF type defined in <code>MobileDevice.framework</code>. It is essentially the object that represents a single iOS Device attached to the host. All functions on an <code>AMDevice</code> start with the prefix <code>AMDevice</code> and typically take an <code>AMDevice</code> as the first argument. An <code>AMDevice</code> will only be present if the device is both booted and attached to the host. It cannot be in DFU or Restore mode.</p>
<p>To operate on an <code>AMDevice</code>, the phone must &quot;trust&quot; the host. You might recognize this as the <a href="https://support.apple.com/en-gb/HT202778" target="_blank" rel="noopener noreferrer">&quot;Trust Dialog&quot; that appears when connecting an iOS Device to a Mac</a>. Most calls will fail if this trust exchange has not been performed. The Mac maintains a local store of the cryptographic components that are used as part of this trust exchange. This local store means that an iOS Device will not constantly require trust to be authorized every time that the iOS Device is connected to the same host. If this process did not take place, then it would be completely infeasible for iOS Devices to be used in a Continuous Integration environment.</p>
<p>Since this is such an important component of how to interact with iOS Devices, it is backed by an Objective-C <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Management/FBAMDevice.h" target="_blank" rel="noopener noreferrer"><code>FBAMDevice</code></a> class.</p>
<p>The process of discovering devices is asynchronous, which means that fetching the list of <code>AMDevice</code>s at a snapshot in time is going to be unreliable. <code>FBDeviceControl</code> instead uses an API within <code>MobileDevice.framework</code> <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Management/FBAMDeviceManager.m#L199" target="_blank" rel="noopener noreferrer">for recieving an <code>AMDevice</code> instance every time there is a state change</a> in the availability of <code>AMDevice</code> instances. This property is also true of Apple&#x27;s tools that build on top of <code>MobileDevice.framework</code>; <a href="https://mokacoding.com/blog/xcodebuild-destination-options/" target="_blank" rel="noopener noreferrer"><code>xcodebuild</code> has a <code>-destination-timeout</code> parameter</a> and Apple Configurator&#x27;s <code>cfgutil</code> has a <code>--timeout</code> parameter since device discovery is delivered asynchronously. You might never notice this in Xcode&#x27;s &quot;Devices and Simulators&quot; window, but it is still there too.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amrestorabledevice"><code>AMRestorableDevice</code><a href="#amrestorabledevice" class="hash-link" aria-label="Direct link to amrestorabledevice" title="Direct link to amrestorabledevice">â€‹</a></h2>
<p><code>AMRestorableDevice</code> is also part of <code>MobileDevice.framework</code>, it represents <strong>any</strong> iOS Device that is attached to the host and powered on. This includes iOS Devices that are booting, booted or in DFU/Restore mode.</p>
<p>This API is extremely limited and only exists to describe devices and perform some actions that are only relevant for devices that are not yet in a booted state. This is used to move a booted device to a DFU/Restore state and back out again. It is useful for understanding why a device that appears to be connected may not be represented by an <code>AMDevice</code> instance.</p>
<p>This is why <code>FBDeviceControl</code> can represent a single <code>FBDevice</code> instance to be backed either or both of an <code>AMDevice</code>/<code>AMRestorableDevice</code>, for the sake of full observability into connected iOS Devices. <code>FBDevice</code> instances will also fail appropriately, for instance when attempting to install an Application to an iOS Device that is in DFU/Restore mode.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amdserviceconnection"><code>AMDServiceConnection</code><a href="#amdserviceconnection" class="hash-link" aria-label="Direct link to amdserviceconnection" title="Direct link to amdserviceconnection">â€‹</a></h2>
<p>This is another CoreFoundation type that represents a connection to a &quot;lockdown service&quot;. In order to get basically anything done on an iOS Device, a connection to service running on the iOS Device is required. There are a huge range of these services for a variety of cases. For example <code>com.apple.syslog_relay</code> is a lockdown service that is used for relaying system logs from the iOS Device to the attached host. You might have seen this used in practice within the &quot;Simulators and Devices&quot; window within Xcode. Connections are created via the <code>AMDeviceSecureStartService</code> call to an <code>AMDevice</code>, returning an <code>AMDServiceConnection</code> type.</p>
<p>There are a number of function calls relevant to this type, dealing with sending and recieving binary data over the connection as if it was a file descriptor. <code>AMDServiceConnection</code> can optionally contain a &quot;secure context&quot;, which is cryptographic information required for sending data over a TLS&#x27;d connection. This is why it is important to use <code>AMDServiceConnection(Send|Recieve)</code> instead of raw <code>read</code>/<code>write</code> syscalls, sending unencrypted information over an encrypted transport will mean that the recieving side is incapable of reading the same data. The presence of a &quot;secure context&quot; can be detected at runtime by inspecting the connection value. In more recent iOS versions, some <a href="https://github.com/facebook/idb/commit/ccff041579475e184695b2cefdc952211dbd6342#diff-7147fc58258b69f4ceb58490a56c16ef795741731f0aed05516b44d397d1e4af" target="_blank" rel="noopener noreferrer">services start requiring usage of encrypted IO</a> so detection and usage of these calls is very important.</p>
<p>It is important to stress that this types is just a &quot;Transport&quot; rather than a &quot;Protocol&quot;. Each &quot;lockdown service&quot; may have it&#x27;s own very different binary protocol for sending and recieving data. In the simple case of <code>com.apple.syslog_relay</code>, the service just repeatedly sends text over the connection. Other protocols, for instance those used by Instruments are far more complicated. There is no single Protocol that is used by all lockdown services.</p>
<p>There is one exception to this, the <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Management/FBAMDServiceConnection.h#L83" target="_blank" rel="noopener noreferrer">&quot;Plist Protocol&quot;</a>. This is implemented in <code>AMDServiceConnection(Send|Recieve)Message</code> calls. This is common across a range of services, such as the screenshot service and SpringBoard service. It&#x27;s essentially wiring a length header followed by a binary plist, this is used on both the send and receive sides.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="afc-apple-file-connection"><code>AFC</code>: &quot;Apple File Connection&quot;<a href="#afc-apple-file-connection" class="hash-link" aria-label="Direct link to afc-apple-file-connection" title="Direct link to afc-apple-file-connection">â€‹</a></h2>
<p><code>AFC</code> is also common throughout the <code>MobileDevice.framework</code> API. This is a set of APIs for file manipulation on an iOS Devices. It is another example of a protocol that wraps an <code>AMDServiceConnection</code> transport. It has a number of functions for dealing with reading, writing, listing directories, moving, copying and deleting files. These operations are performed on the <code>AFCConnection</code> type.</p>
<p>On non-jailbroken devices, there is no way of getting an <code>AFC</code> connection for the entire root filesystem of the Device. Instead, there are different lockdown services corresponding to various containers or sandboxes within the iPhone&#x27;s operating system. Access to Photos/Media (<code>com.apple.afc</code>), Application Sandboxes (<code>AMDeviceCreateHouseArrestService</code>) and crash logs (<code>com.apple.crashreportcopymobile</code>) are all examples of <code>AFC</code> services.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="developer-disk-images">Developer Disk Images<a href="#developer-disk-images" class="hash-link" aria-label="Direct link to Developer Disk Images" title="Direct link to Developer Disk Images">â€‹</a></h2>
<p>Whilst iOS by default has a number of different lockdown services provided within the base iOS image, not all of the functionality that is available within Xcode is implemented from services in the base OS. In order to augment the iOS Device with additional functionality to an attached macOS host, <a href="https://github.com/facebook/idb/blob/main/FBControlCore/Utility/FBDeveloperDiskImage.m" target="_blank" rel="noopener noreferrer">Xcode bundles a &quot;Developer Disk Image&quot;</a>.</p>
<p>This is a regular <code>.dmg</code> file, which can be opened on macOS. Within this disk image is a number of executables, libraries and <code>plist</code>s describing the lockdown services that get added to the iOS Device upon mounting them on the device. <code>FBDeviceControl</code> provides an API for manipulating the <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Commands/FBDeviceDeveloperDiskImageCommands.m" target="_blank" rel="noopener noreferrer">disk image manipulation functions in <code>MobileDevice.framework</code></a>. It is not possible to mount arbitrary disk image on an iOS Device as every disk image and it&#x27;s binaries are signed by Apple, only disk images that have genuine Apple signing are allowed to be mounted. There&#x27;s some evidence within <code>MobileDevice.framework</code> to suggest that Apple uses these Disk Images internally for developing iOS itself.
The &quot;Developer Disk Image&quot;s may be different for each major/minor iOS verion. This is presumably because the lockdown services interact with APIs on the device that can change in iOS versions. The services that are contained within the Developer Disk Image are associated with functionality that is specific to Xcode, Instruments and Accessibility Inspector. The <a href="https://github.com/facebook/idb/commit/5b4415a4fa20a49e03f7596cf5fc296efd25df42" target="_blank" rel="noopener noreferrer">usage of and availability of these services can change over Xcode versions</a>, so there may be differences in the implementation of clients depending on the protocol version of the service that the client is communicating with.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="manipulating-disk-images">Manipulating Disk Images<a href="#manipulating-disk-images" class="hash-link" aria-label="Direct link to Manipulating Disk Images" title="Direct link to Manipulating Disk Images">â€‹</a></h3>
<p>Any <code>FBDeviceControl</code> functionality that depends on a service provided by a &quot;Developer Disk Image&quot; will implicitly search for and subsequently mount the most appropriate disk image for the attached iOS device. <code>idb</code> also provides ways of manually managing the mounting of these disk images through the &quot;disk image container&quot; of file commands:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># List all of the available disk images that are present within the current Xcode, as well as the current mounted image/s (if present).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># No images are mounted as the &quot;mounted&quot; path is empty.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file ls --disk-images .</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">15.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.4/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.5/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11.4/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.4/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.6/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.5/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12.4/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">14.1/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">11.2/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9.3/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13.7/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file ls --disk-images mounted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Mounting for the current iOS Version of the attached device (iOS 15.0 succeeds).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file mv --disk-images 15.0/DeveloperDiskImage.dmg mounted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Now we can see that the image is mounted.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file ls --disk-images mounted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">15.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Unmount the disk image by rm&#x27;ing it. The disk image is kept intact on the host, but is unmounted from the device.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file rm --disk-images mounted/15.0/DeveloperDiskImage.dmg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb file ls --disk-images mounted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="instruments-service">Instruments Service<a href="#instruments-service" class="hash-link" aria-label="Direct link to Instruments Service" title="Direct link to Instruments Service">â€‹</a></h2>
<p>The &quot;Instruments Service&quot;, which is a service within the &quot;Developer Disk Image&quot; is a very important one with respect to iOS Device automation. Since <code>Instruments.app</code> and the <code>instruments</code> commandline offers a lot of functionality for launching and profiling Applications and iOS Devices, it is integral to tasks such as app launching and process listing on iOS Devices.</p>
<p>The client-side implementation of this protocol is provided via <code>DTXConnectionServices</code>, with a <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Management/FBInstrumentsClient.h" target="_blank" rel="noopener noreferrer">provisional re-implementation within <code>FBDeviceControl</code></a>. There are more details about the makeup of this protocol <a href="https://github.com/troybowman/ios_instruments_client" target="_blank" rel="noopener noreferrer">within the <code>ios_instruments_client</code> project</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="video-encoding">Video Encoding<a href="#video-encoding" class="hash-link" aria-label="Direct link to Video Encoding" title="Direct link to Video Encoding">â€‹</a></h2>
<p>One of the key features of <code>FBDeviceControl</code> is the ability to stream the iPhone&#x27;s screen to the host over USB. You might be familiar with this within QuickTime&#x27;s &quot;Screen Recording&quot; feature, where you can record video from a connected iOS Device to an <code>.mp4</code> file on your Mac.</p>
<p>Access to this <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Video/FBDeviceVideo.m#L38" target="_blank" rel="noopener noreferrer">is provided via <code>AVFoundation</code></a> as a &quot;Capture Device&quot;. Usage of &quot;Capture Devices&quot; on macOS also requires that the hosting process (The process using <code>FBDeviceControl</code>) has system-level permissions for this on more recent versions of macOS. With a Capture Device for the iOS Device screen, it is then possible to create a &quot;Capture Session&quot; with the device. A &quot;Capture Session&quot; can thent be established, with relevant configuration so that frames are received in the most optimal format for the consumer. <code>FBDeviceControl</code> receives frame samples from the device and these samples are either re-encoded or not before being passed on to a stream of data.</p>
<p><code>FBDeviceControl</code> supports writing to an <code>mp4</code> video file or as a stream of encoded data. For streams of data, these can be passed to other Applications for cases like webRTC or HTTP Live-Streaming.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-applications">Debugging Applications<a href="#debugging-applications" class="hash-link" aria-label="Direct link to Debugging Applications" title="Direct link to Debugging Applications">â€‹</a></h2>
<p><code>idb</code> (via <code>FBDeviceControl</code>) has support for launching a <code>debugserver</code> on an iOS Device. This enables debugging Apps on iOS Devices, without having to run via Xcode. There are some important considerations in terms of what is possible:</p>
<ul>
<li>Only <code>lldb</code> may be used as the debugger client.</li>
<li>Only &quot;Developer Signed&quot; Applications may be debugged. Debugging Enterprise signed or App Store Apps is not supported or allowed by iOS.</li>
<li>Attaching to an already-launched Application is not supported or allowed by iOS. Debugged Applications must be launched by the debugger.</li>
</ul>
<p>Debugging an app on an iOS Device isn&#x27;t quite as simple as an <code>lldb</code> one-liner. However, the only process that changes is how to start a debugging session. The process for a device is as follows:</p>
<ol>
<li>The Application to debug is installed on the iOS Device. A copy of the Application is also present/saved on the host attached to the device. The copy of the App is required on the host as this is needed for <code>lldb</code> to be able to symbolicate symbols within the debugged app.</li>
<li><a href="#developer-disk-images">A Developer Disk Image</a> for the current device is mounted. This is required as the <code>debugserver</code> lockdown service is contained within the Developer Disk Image.</li>
<li>The <a href="https://github.com/facebook/idb/blob/main/FBDeviceControl/Commands/FBDeviceDebuggerCommands.m#L76" target="_blank" rel="noopener noreferrer"><code>debugserver</code> service is started via lockdown</a>. This results in a bi-directional socket stream that <code>lldb</code> can talk to. This is a <a href="https://lldb.llvm.org/use/remote.html" target="_blank" rel="noopener noreferrer">remote debugging server, using the gdb protocol</a>.</li>
<li>The <code>debugserver</code> service must be made accessible to <code>lldb</code>. This is done by wrapping the <code>debugserver</code> connection within a socket, so that it can be connected to outside of the process that obtained the <code>debugserver</code> socket.</li>
<li><code>lldb</code> is started and then connects to the <code>debugserver</code> via the exposed socket. A series of commands are sent to <code>lldb</code> so that it understands how to connect to the remote debugserver and how to talk to it.</li>
<li><code>lldb</code> can now launch and debug the application.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-debuggable-app">A &quot;debuggable app&quot;<a href="#a-debuggable-app" class="hash-link" aria-label="Direct link to A &quot;debuggable app&quot;" title="Direct link to A &quot;debuggable app&quot;">â€‹</a></h3>
<p>Aside from the previously-mentioned requirement that an App is only debuggable if it is &quot;Developer Signed&quot;, there is an additional contraint around App debuggability; a copy of the Application must be persisted on the host attached to the device. This is required so that <code>lldb</code> has a local copy of the Application available to it for the purpose of symbolication.</p>
<p><code>idb</code> can do this via the <code>--make-debuggable</code> flag upon an <code>idb install</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Install an app, also persisting it to disk so that idb can later find it when launching a debugserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb install --make-debuggable /path/to/SomeApp.app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also confirm whether an app is debuggable or not in the output of <code>idb list-apps</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb list-apps | grep SomeApp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">com.foo.SomeApp | SomeApp | user_development | no archs available | Unknown | Debuggable | pid=None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the application is listed as &quot;Debuggable&quot; then a <code>debugserver</code> can be started against it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="starting-a-debugserver">Starting a <code>debugserver</code><a href="#starting-a-debugserver" class="hash-link" aria-label="Direct link to starting-a-debugserver" title="Direct link to starting-a-debugserver">â€‹</a></h3>
<p>A <code>debugserver</code> can then be started for any &quot;Debuggable&quot; App. This is done with the <code>idb debugserver</code> command.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Start the debugserver, a list of bootstrapping commands are returned on stdout</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ idb debugserver start com.foo.SomeApp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">platform select remote-ios --sysroot &#x27;/Users/Someone/Library/Developer/Xcode/iOS DeviceSupport/15.2.1 (19C63) arm64e/Symbols&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target create &#x27;/private/tmp/idb-applications/com.foo.SomeApp/SomeApp.app&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">script lldb.target.modules[0].SetPlatformFileSpec(lldb.SBFileSpec(&quot;/private/var/containers/Bundle/Application/64B4DDB3-1049-458C-AA0B-F56AF4DCF0E0/SomeApp.app&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">process connect connect://localhost:10881</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The bootstrapping commands returned can then be used to initialize a debug session via <code>lldb</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bootstrapping-via-lldb">Bootstrapping via <code>lldb</code><a href="#bootstrapping-via-lldb" class="hash-link" aria-label="Direct link to bootstrapping-via-lldb" title="Direct link to bootstrapping-via-lldb">â€‹</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Start lldb and pass the bootrapping commands from above</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ lldb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) platform select remote-ios --sysroot &#x27;/Users/Someone/Library/Developer/Xcode/iOS DeviceSupport/15.2.1 (19C63) arm64e/Symbols&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Platform: remote-ios</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Connected: no</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SDK Path: &quot;/Users/Someone/Library/Developer/Xcode/iOS DeviceSupport/15.2.1 (19C63) arm64e/Symbols&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) target create &#x27;/private/tmp/idb-applications/com.foo.SomeApp/SomeApp.app&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">script lldb.target.modules[0].SetPlatformFileSpec(lldb.SBFileSpec(&quot;/private/var/containers/Bundle/Application/64B4DDB3-1049-458C-AA0B-F56AF4DCF0E0/SomeApp.app&quot;))Current executable set to &#x27;/private/tmp/idb-applications/com.foo.SomeApp/SomeApp.app&#x27; (arm64).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) script lldb.target.modules[0].SetPlatformFileSpec(lldb.SBFileSpec(&quot;/private/var/containers/Bundle/Application/64B4DDB3-1049-458C-AA0B-F56AF4DCF0E0/SomeApp.app&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) process connect connect://localhost:10881</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(lldb) r</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Process 10416 launched: &#x27;/private/tmp/idb-applications/com.foo.SomeApp/SomeApp.app/SomeApp&#x27; (arm64)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Upon <code>process connect</code> completing, the <code>lldb</code> will then be attached to the remote <code>debugserver</code>. The app will in a ready state, but not launched, this can be done with the <code>run</code> command in <code>lldb</code> that will launch the app.
At this point <code>lldb</code> can be used as a regular debugger, there&#x27;s some <a href="https://lldb.llvm.org/use/map.html" target="_blank" rel="noopener noreferrer">good documentation about how to use <code>lldb</code> via it&#x27;s command prompt in <code>lldb</code>&#x27;s documenation</a>. One important note is that you can only have one debug session with a launched debugserver. To start a new debug session after <code>process connect</code>, the debugserver needs to be re-started via <code>idb debugserver stop</code> and subsequently running <code>idb debugserver start</code> again.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/fbsimulatorcontrol"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">FBSimulatorControl</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/video"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Video</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mobiledeviceframework" class="table-of-contents__link toc-highlight"><code>MobileDevice.framework</code></a></li><li><a href="#amdevice" class="table-of-contents__link toc-highlight"><code>AMDevice</code></a></li><li><a href="#amrestorabledevice" class="table-of-contents__link toc-highlight"><code>AMRestorableDevice</code></a></li><li><a href="#amdserviceconnection" class="table-of-contents__link toc-highlight"><code>AMDServiceConnection</code></a></li><li><a href="#afc-apple-file-connection" class="table-of-contents__link toc-highlight"><code>AFC</code>: &quot;Apple File Connection&quot;</a></li><li><a href="#developer-disk-images" class="table-of-contents__link toc-highlight">Developer Disk Images</a><ul><li><a href="#manipulating-disk-images" class="table-of-contents__link toc-highlight">Manipulating Disk Images</a></li></ul></li><li><a href="#instruments-service" class="table-of-contents__link toc-highlight">Instruments Service</a></li><li><a href="#video-encoding" class="table-of-contents__link toc-highlight">Video Encoding</a></li><li><a href="#debugging-applications" class="table-of-contents__link toc-highlight">Debugging Applications</a><ul><li><a href="#a-debuggable-app" class="table-of-contents__link toc-highlight">A &quot;debuggable app&quot;</a></li><li><a href="#starting-a-debugserver" class="table-of-contents__link toc-highlight">Starting a <code>debugserver</code></a></li><li><a href="#bootstrapping-via-lldb" class="table-of-contents__link toc-highlight">Bootstrapping via <code>lldb</code></a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://discord.gg/SF26Yqw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contribute</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.png" alt="idb" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/oss_logo.png" alt="idb" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright Â© 2026 Facebook, Inc.</div></div></div></footer></div>
</body>
</html>